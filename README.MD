# Установка TPWS на OpenWRT в режиме **OCHE** острой нехватки места на диске

Потребуется всего 4 КиБ. TPWS и конфиги будет загружаться архивом в /tmp при запуске роутера.


### Структура архива:

```bash
tinytpws.tar.gz
|__ tpws # <-- Скомпилированный под архитектуру роутера бинарь TPWS
|__ tpws-config # <-- Файл со стратегиями для TPWS, для синхронизации с серверными
|__ tpws-whitelist # <-- Для hostlist-exclude, копируется в /etc/tpws-whitelist
```

Также, если обновление конфигов и белого списка с сервера не требуется, можно создать
пустой файл /etc/tpws-no-config-update, тогда конфиги обновляться не будут и в архиве
достаточно будет хранить только скомпилированный бинарник tpws.

Нужно собрать его до установки и захостить где-нибудь на удалённом сервере.

Чтобы качался быстрее, собирать с макс сжатием: `tar cvf - ./tp* | gzip -9 - > tinytpws.tar.gz`


### Установка:

1. `chmod +x ./etc/init.d/tpws ./etc/tpws-firewall.sh`
2. Содержимое etc репозитория скопировать в /etc роутера
3. Внутри /etc/init.d/tpws в переменной URL_TTPWS указать URL на архив для скачивания
4. Включить автозапуск, если надо (иногда не работает) — `etc/init.d/tpws enable`
5. `etc/init.d/tpws start`
